"use strict";var ModelModule=function(){var a=function(){this.listeners=[]};_.extend(a.prototype,{addListener:function(a){this.listeners.push(a)},removeListener:function(a){var b=this.listeners.indexOf(a);-1!==b&&this.listeners.splice(b,1)},notify:function(a){_.each(this.listeners,function(b){b.update(a)})},update:function(a){}});var b=function(b,c,d,e,f){a.apply(this,arguments),this.name=b,this.id=c,this.code=d,this.lat=e,this["long"]=f,this.isShown=!1};_.extend(b.prototype,a.prototype,{});var c=function(){a.apply(this,arguments),this.list=[]};return _.extend(c.prototype,a.prototype,{}),{BuildingModel:b,BuildingListModel:c}}(),ServiceModule=function(){var a=function(){this.key="c965fdb4a48bb71c48d4244331c86231",this.urlPrefix="https://api.uwaterloo.ca/v2/buildings/list.json?key=",this.buildings=[]};return _.extend(a.prototype,{queryBuildings:function(){var a=Q.defer();return $.get(this.urlPrefix+this.key).success(function(b){a.resolve(b.data)}).fail(function(){a.reject()}),a.promise},getBuilding:function(a){return a}}),{UWaterlooService:a}}(),ViewModule=function(a){var b=function(a){this.model=a,this.model.addListener(this)};_.extend(b.prototype,{init:function(){},update:function(a){}});var c=function(a,c,d){b.apply(this,arguments),this.UWaterlooService=c,this.map=d,this.init()};_.extend(c.prototype,b.prototype,{init:function(){var b=this;this.UWaterlooService.queryBuildings().then(function(c){$.each(c,function(c,d){var e=document.querySelector("#options"),f=d.building_name,g=d.building_id;e.content.querySelector(".item").innerHTML='<span class="checkbox"> <span class="glyphicon glyphicon-ok"></span></span> '+f+" ("+d.building_code+")";var h=new a(d.building_name,d.building_id,d.building_code,d.latitude,d.longitude),i=document.importNode(e.content,!0);document.querySelector("#search").appendChild(i),$(".item").last().attr("id",g),b.model.list.push(h);var j=new google.maps.LatLng(d.latitude,d.longitude),k=new google.maps.Marker({position:j,title:f,animation:google.maps.Animation.DROP});$("#"+g).click(function(){h.isShown?(k.setMap(null),h.isShown=!1):(k.setMap(b.map),h.isShown=!0)})})}),this.update()}});var d=function(a,c){b.apply(this,arguments),this.UWaterlooService=c,this.init()};return _.extend(d.prototype,b.prototype,{}),{BuildingListView:c,MapView:d}}(ModelModule.BuildingModel);!function(a,b,c){$(document).ready(function(){function d(){e=new google.maps.Map(document.getElementById("map-canvas"),{zoom:17,center:{lat:43.472761,lng:-80.542164}})}var e;d();var f=new a.BuildingListModel,g=new c.UWaterlooService;new b.BuildingListView(f,g,e);$("#searchbar").on("input",function(){for(var a=$("#searchbar").val(),b=a.length,c=0;b+1>c;c++)a=a.substring(0,3*c)+".*"+a.substring(3*c,a.length);var d=new RegExp(a,"i");$.each(f.list,function(a,b){d.test(b.name)||d.test(b.code)?($("#"+b.id).removeClass("hide"),$("#"+b.id).parent().removeClass("hide")):($("#"+b.id).addClass("hide"),$("#"+b.id).parent().addClass("hide"))})})})}(ModelModule,ViewModule,ServiceModule);